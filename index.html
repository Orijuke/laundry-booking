<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–∏—Ä–æ–∫ ‚Äî —É–ª. –°–µ–¥–æ–≤–∞, 91–∫6</title>
  <link rel="icon" href="img/favicon.ico" type="image/x-icon">
  <link rel="icon" href="img/laundry-machine.png" type="image/png">
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <button id="profile-btn" class="button-54">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
    <h1 id="current-date"></h1>
    <input type="date" id="date-picker">
  </header>

  <main>
    <div class="table-container">
      <table id="schedule-table">
        <thead>
          <tr>
            <th>–í—Ä–µ–º—è</th>
            <th>–£ —Å—Ç–µ–Ω—ã</th>
            <th>–£ –¥–≤–µ—Ä–∏</th>
          </tr>
        </thead>
        <tbody>
          <!-- –°–ª–æ—Ç—ã –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã JavaScript -->
        </tbody>
      </table>
    </div>
  </main>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
  <div id="booking-modal" class="modal hidden">
    <div class="modal-content">
      <p>–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å <span id="modal-time"></span> <span id="modal-machine"></span>?</p>
      <div class="button-group">
        <button id="confirm-booking" class="button-54">‚úîÔ∏è –î–∞</button>
        <button id="cancel-booking" class="button-54">‚ùå –ù–µ—Ç</button>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–º–µ–Ω—ã –±—Ä–æ–Ω–∏ -->
  <div id="cancel-modal" class="modal hidden">
    <div class="modal-content">
      <p>–û—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω—å –Ω–∞ <span id="cancel-modal-time"></span> <span id="cancel-modal-machine"></span>?</p>
      <div class="button-group">
        <button id="confirm-cancel" class="button-54">–û—Ç–º–µ–Ω–∏—Ç—å</button>
        <button id="deny-cancel" class="button-54">–ù–µ –æ—Ç–º–µ–Ω—è—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Firebase –∏ –º–æ–¥—É–ª–∏ -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-app.js";
    import { getDatabase } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-database.js";

    const firebaseConfig = {
      databaseURL: "https://laundry-booking-sedova-91k6-default-rtdb.europe-west1.firebasedatabase.app"
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // –î–µ–ª–∞–µ–º db –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
    window.db = db;
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase
    import { storage } from './js/storage.js';
    import { schedule } from './js/schedule.js';
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    document.addEventListener('DOMContentLoaded', () => {
      const currentUser = storage.getUser();
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è
      const profileBtn = document.getElementById('profile-btn');
      if (profileBtn) {
        if (currentUser) {
          profileBtn.textContent = `üë§ ${currentUser.name || '–ü—Ä–æ—Ñ–∏–ª—å'} | ${currentUser.room || ''}`;
        }
        profileBtn.addEventListener('click', () => {
          window.location.href = 'profile.html';
        });
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—Ç—ã
      const today = new Date();
      const datePicker = document.getElementById('date-picker');
      const currentDateElement = document.getElementById('current-date');
      
      datePicker.value = today.toISOString().split('T')[0];
      datePicker.min = datePicker.value;
      currentDateElement.textContent = today.toLocaleDateString('ru-RU', {
        day: 'numeric',
        month: 'long',
        weekday: 'long'
      });

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
      if (typeof schedule !== 'undefined') {
        schedule.initSchedule();
      }

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
      datePicker.addEventListener('change', (e) => {
        const selectedDate = e.target.value;
        currentDateElement.textContent = new Date(selectedDate).toLocaleDateString('ru-RU', {
          day: 'numeric',
          month: 'long',
          weekday: 'long'
        });
        schedule.renderSchedule(selectedDate);
      });

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
      document.getElementById('confirm-booking')?.addEventListener('click', () => {
        const selectedDate = datePicker.value;
        schedule.handleConfirmBooking(selectedDate);
      });

      document.getElementById('cancel-booking')?.addEventListener('click', () => {
        document.getElementById('booking-modal').classList.add('hidden');
      });

      document.getElementById('confirm-cancel')?.addEventListener('click', () => {
        schedule.handleConfirmCancel();
      });

      document.getElementById('deny-cancel')?.addEventListener('click', () => {
        document.getElementById('cancel-modal').classList.add('hidden');
      });
    });
  </script>
</body>
</html>
